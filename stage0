#!/bin/sh

./clean
. ./prepare-env
. ./prepare-root

mkdir -p src cross

# Deps list
./build cross-scripts/musl
./build cross-scripts/libevent
./build cross-scripts/ncurses
./build cross-scripts/zlib

# Build stage0 packages
pkglist=$(ls pkgs)
for pkg in $pkglist; do
	./build pkgs/$pkg
done

# Strip all executables
find $root/bin -executable -type f -exec strip {} \; &>/dev/null

pushd $root
echo Creating ramdisk
find . | cpio --quiet -H newc -o | gzip -9 -n > ../morpheus.img
popd

echo OK!
